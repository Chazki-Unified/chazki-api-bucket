openapi: 3.0.0
info:
  title: Perú Legacy API
  description: |
    This documentation is only valid for Peru. In order to place orders 
    for Chazki services, endpoints were set up to record delivery and check 
    the status of orders.


    These services are registered in the domain owned by chazki and are 
    detailed in the section below.


    Find more about [Chazki here](https://chazki.com/#/). 
    See also our [Terms and Conditions](https://chazki.com/privacidad).


    #ANEXO


    ##States of Orders


    | Estado                  | Descripción                                |
    | ----------------------- | ----------------------------------------------------------------------- |
    |  NEW                    | The order is just entered into the system                               |
    |  PRE_OFFERED            | Status prior to the order being sent to planning and offered            |
    |  OFFERED                | The request is offered for a Chazki to accept                           |
    |  WAITING                | The Chazki is on his way to pick up the order                           |
    |  ARRIVED                | The Chazki arrives at the order pick-up point                           |
    |  FAILED_PICK            | Error during order pick up                                              |
    |  IN_PROGRESS            | The Chazki is on his way to deliver the order                           |
    |  FAILED                 | Failure occurred during the delivery of the order                       |
    |  COMPLETED              | The order is delivered successfully                                     |
    |  REPROGRAMMED           | The order is rescheduled                                                |


    ##Order Types


    | Estado                  | Descripción                                |
    | ----------------------- | ----------------------------------------------------------------------- |
    |  REGULAR                | Order that can be delivered the next day after being requested          |
    |  EXPRESS                | Order that is delivered in a maximum of 3 hours the same day it is made |
    |  PROGRAMADO             | Order delivered according to three schedules: 9-13, 13-17, 17-21        |
    |  FOOD                   | Food order scheduled to be delivered within one hour                    |
    |  FOOD_PROGRAMADO        | Food order scheduled to be delivered at a specific time                 |
    

    ##Timezone


    | Ciudad                  | UTC       | UTC DST (Verano) | Timezone    |
    | ----------------------- | --------- | ---------------- | ------------------------------------------- |
    |  Lima                | UTC -5       | UTC -5       | America/Lima                         |
    |  Ciudad de Mexico    | UTC -6       | UTC -5       | America/Mexico_City                  |
    |  Guadalajara         | UTC -6       | UTC -5       | America/Mexico_City                  |
    |  Monterrey           | UTC -6       | UTC -5       | America/Monterrey                    |
    |  Buenos Aires        | UTC -3       | UTC -3       | America/Argentina/Buenos_Aires       |


    ###List of all recorded timezones


    wiki: <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank">Lista de todos los timezones</a>
      

    ##URL Encode


    To send the timezone as a query param, it is necessary to encode the timezone.


    | Timezone                  | Encode              |
    | ------------------------- | -------------------------------------------- |
    |  America/Lima                         | America%2fLima                      |
    |  America/Mexico_City                  | America%2fMexico_City               |
    |  America/Mexico_City                  | America%2fMexico_City               |
    |  America/Monterrey                    | America%2fMonterrey                 |
    |  America/Argentina/Buenos_Aires       | America%2fArgentina%2fBuenos_Aires  |
  termsOfService: https://chazki.com/tyc.html
  contact:
    email: apiteam@swagger.io
  version: 1.0.0
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
servers:
  - url: https://us-central1-chazki-link-dev.cloudfunctions.net/cf-custom-integrations-dev/api/legacy/peru
    description: Legacy Development
  - url: https://us-central1-chazki-link-beta.cloudfunctions.net/cf-custom-integrations-dev/api/legacy/peru
    description: Legacy Beta
  - url: https://us-central1-chazki-link.cloudfunctions.net/cf-custom-integrations-dev/api/legacy/peru
    description: Legacy Production
tags:
  - name: WebServices
    description: List of endpoints for register and consult of the orders status.
  - name: Anexos
    description: List of tables 
paths:
  "/create/delivery-service":
    post:
      tags:
        - WebServices
      description:
        This endpoint allows you to register a delivery or route. 
        Since the shipment is an arrangement, several points can be 
        registered where you want the Chazki to arrive, therefore, a 
        route is formed; otherwise, only one arrival point can be registered.
      operationId: delivery-service
      security:
        - chazki-api-key: []
      parameters:
        - name: code
          in: query
          description: Delivery track code.
          required: true
          style: form
          explode: false
          schema:
            type: string
        - name: enterpriseKey
          in: query
          description: Client unique authorization code.
          required: true
          style: form
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    example: 1
                  position:
                    type: object
                    properties:
                      latitude:
                        type: number
                        example: -12.046502
                      longitude:
                        type: number
                        example: -77.042716
                  status:
                    type: number
                    example: ASSIGNED
                  timestamp:
                    type: string
                    example: "2020-04-30T00:00:00.000Z"
                  rd:
                    type: string
                    example: Nombre repartidor
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/tracking/select/delivery-code":
    get:
      tags:
        - WebServices
      description:
        This API allows us to see the movement of the Chazki and the status of the delivery.
      operationId: Status-position of the order
      security:
        - chazki-api-key: []
      parameters:
        - "$ref": '#/components/parameters/queryCode'
        - "$ref": '#/components/parameters/queryTimeZone'
        - "$ref": '#/components/parameters/queryLanguage'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  position:
                    type: object
                    description: Latitude and longitude points.
                    properties:
                      latitude:
                        type: number
                        example: 0
                      longitude:
                        type: number
                        example: 0
                  status:
                    type: number
                    description: State in which the delivery.
                    example: ASSIGNED
                  timestamp:
                    type: string
                    description: Date of the last update of the Chazki position.
                    example: "2020-04-30T00:00:00.000Z"
                  rd:
                    type: string
                    description: Name of the Chazki.
                    example: Drive name 
                  cel:
                    type: string
                    description: Chazki's phone.
                    example: Number Phone 
                  motivo: 
                    type: string
                    description: The reason is displayed if any failure occurred.
                    example: Client not available
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/status/record":
    get:
      tags:
        - WebServices
      description: |
        This API allows us to see the states through which the delivery passed grouped 
        by services. The grouping of services refers to the attempts that were made to 
        deliver the delivery.
      operationId: History state
      security:
        - chazki-api-key: []
      parameters:
        - "$ref": '#/components/parameters/queryCode'
        - "$ref": '#/components/parameters/queryTimeZone'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    example: 1
                  descriptionResponse: 
                    type: string
                    description: Response description
                    example: SUCCESS
                  message: 
                    type: string
                    description: message description
                    example: ""
                  "service_1":
                    type: array
                    description: Services through which the delivery passed
                    items:
                        type: object
                        "$ref": "#/components/schemas/service"
                  "service_2":
                    type: array
                    description: Services through which the delivery passed
                    items:
                        type: object
                        "$ref": "#/components/schemas/service"
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/status/record/all":
    get:
      tags:
        - WebServices
      description: |
        This API allows us to see the states through which the delivery passed grouped 
        by services. The grouping of services refers to the attempts that were made to 
        deliver the delivery.
      operationId: History internal states
      security:
        - chazki-api-key: []
      parameters:
        - "$ref": '#/components/parameters/queryCode'
        - "$ref": '#/components/parameters/queryTimeZone'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    example: 1
                  descriptionResponse: 
                    type: string
                    description: Response description
                    example: SUCCESS
                  timezone: 
                    type: string
                    description: Indicates the timezone used, by default "UTC"
                    example: "UTC"
                  statusList:
                    type: array
                    description: Array with all states of the order (internal states of chazki)
                    items:
                        type: object
                        "$ref": "#/components/schemas/serviceAll"
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/tracking/images":
    get:
      tags:
        - WebServices
      description:
        This API allows us to see the photos taken by the chazki at the time of delivery.
      operationId: Images of the Order
      security:
        - chazki-api-key: []
      parameters:
        - "$ref": '#/components/parameters/queryCode'
        - "$ref": '#/components/parameters/queryLanguage'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    description: 'Code response (0: Error, 1: Ok).'
                    example: 1
                  deliveryResponse: 
                    type: string
                    description: Code description.
                    example: SUCCESS
                  status: 
                    type: string
                    description: Status of the order at the time of the request.
                    example: "UTC"
                  orderAssociated:
                    type: string
                    description: Base64 image of the chazki associated with the order.
                    example: iVBORw0KGgoAAAANSUhEUgAAAl8AAAQ4CAIAAAC4
                  orderImages:
                    type: array
                    description: Base64 images taken by the chazki associated with the order.
                    items:
                      type: string
                      example: iVBORw0KGgoAAAANSUhEUgAAAl8AAAQ4CAIAAAC4
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/tracking/label":
    get:
      tags:
        - WebServices
      description:
        This API allows us to obtain a label with the address of the order.
      operationId: Single Labels
      security:
        - chazki-api-key: []
      parameters:
        - "$ref": '#/components/parameters/queryCode'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    description: 'Code response (0: Error, 1: Ok).'
                    example: 1
                  deliveryResponse: 
                    type: string
                    description: PDF of the order label in base 64
                    example: iVBORw0KGgoAAAANSUhEUgAAAl8AAAQ4CAIAAAC4
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
  "/tracking/label/all":
    post:
      tags:
        - WebServices
      description:
        This API allows us to obtain a label with the address of the order.
      security:
        - chazki-api-key: []
      operationId: Group Labels
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/labelsOrders'
      responses:
        "200": 
          description: Successfully response object.
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: number
                    description: 'Code response (0: Error, 1: Ok).'
                    example: 1
                  deliveryResponse: 
                    type: string
                    description: PDF of the order label in base 64
                    example: iVBORw0KGgoAAAANSUhEUgAAAl8AAAQ4CAIAAAC4
        "400":
          description: Query response with errors.
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/FailFnResponse"
components:
  schemas:
    FailFnResponse:
      type: object
      properties:
        response:
          type: number
          description: 'Code response (0: Error, 1: Ok).'
          example: 0
        descriptionResponse:
          type: string
          description: Bug Description.
          example: El trackcode no existe o el enterpriseKey no es correcto
    labelsOrders:
      type: object
      properties:
        trackCodes:
          type: array
          description: List of registered trackCodes.
          required: true
          items:
            type: string
            example: NroOrden1
    service:
      type: object
      properties:
        status:
          type: string
          description: Delivery status
          example: NEW
        date:
          type: string
          description: Status date
          example: "2020-04-30T00:00:00.000Z"
        reason:
          type: string
          description: |
            Only for failed states. Reason if the status was "Pickup Failed" 
            or "Delivery Failed"
          example: ""
        reasonCode:
          type: string
          description: |
            Only for failed states. Reason code if the status was "Pickup Failed" 
            or "Delivery Failed"
          example: ""
    serviceAll:
      type: object
      properties:
        status:
          type: string
          description: Delivery status
          example: NEW
        date:
          type: string
          description: Status date
          example: "2020-04-30T00:00:00.000Z"
        attemptNumber:
          type: number
          description: |
            Indicates the number of delivery attempts, it increases based on rescheduling. 
            By default 1
          example: 1
        reason:
          type: string
          description: |
            Only for failed states. Reason if the status was "Pickup Failed" 
            or "Delivery Failed"
          example: ""
        reasonCode:
          type: string
          description: |
            Only for failed states. Reason code if the status was "Pickup Failed" 
            or "Delivery Failed"
          example: ""
  parameters:
    queryCode:
      name: code
      in: query
      description: Delivery track code.
      required: true
      style: form
      explode: false
      schema:
        type: string
    queryTimeZone:
      name: timezone
      in: query
      description: Timezone of city. [Anexo Timezone](https://chazki.com/#/)
      required: false
      style: form
      explode: false
      schema:
        type: string
    queryLanguage:
      name: language
      in: query
      description: Language for message response.
      required: false
      style: form
      explode: false
      schema:
        type: string
  securitySchemes:
    chazki-api-key:
      name: chazki-api-key
      type: apiKey
      in: header
      description: Access key for api.
      example: xxXXxxXX-xXx-xXxX-XxXx-xxXXxxXXxxXX